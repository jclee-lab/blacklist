= ğŸ›ï¸ 9. Live Dashboard =

{{info}}
ì´ í˜ì´ì§€ëŠ” Blacklist Platformì˜ ì‹¤ì‹œê°„ ìƒíƒœë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
**30ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨**ë©ë‹ˆë‹¤.
{{/info}}

----

== System Status ==

{{velocity}}
#set($apiBaseUrl = "http://blacklist.jclee.me:2542/api")

## Try to fetch stats from API
#set($statsUrl = "${apiBaseUrl}/stats")
#try
  #set($statsResponse = $request.get($statsUrl))
  #set($stats = $jsontool.parse($statsResponse.body))

  |= Metric |= Value |= Status
  | **Total Blacklist IPs** | $stats.blacklist.total | {{success}}Active{{/success}}
  | **Active Blacklist IPs** | $stats.blacklist.active | {{success}}Monitored{{/success}}
  | **Total Whitelist IPs** | $stats.whitelist.total | {{success}}Protected{{/success}}
  | **Last Collection Date** | $stats.collection.last_date | #if($stats.collection.status == "success"){{success}}Success{{/success}}#else{{error}}Failed{{/error}}#end
  | **System Health** | $stats.health.status | {{success}}Healthy{{/success}}
  | **Uptime** | $stats.health.uptime | {{info}}Running{{/info}}

  {{success}}
  **Last Updated**: $datetool.get('yyyy-MM-dd HH:mm:ss')
  {{/success}}

#catch
  {{error}}
  **API ì—°ê²° ì‹¤íŒ¨**: Blacklist ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.

  **Troubleshooting**:
  * ì„œë¹„ìŠ¤ ìƒíƒœ: {{code}}docker-compose ps{{/code}}
  * ë¡œê·¸ í™•ì¸: {{code}}docker-compose logs -f blacklist-app{{/code}}
  * Health Check: {{code}}curl http://blacklist.jclee.me:2542/health{{/code}}
  {{/error}}
#end
{{/velocity}}

----

== Recent Activity ==

{{velocity}}
#set($activityUrl = "${apiBaseUrl}/monitoring/dashboard")
#try
  #set($activity = $jsontool.parse($request.get($activityUrl).body))

  === IP Check Statistics (Last Hour) ===

  |= Decision |= Count |= Percentage
  | Allowed (Whitelist) | $activity.decisions.whitelist_hits | $activity.decisions.whitelist_percent%
  | Allowed (Not in Blacklist) | $activity.decisions.not_found | $activity.decisions.not_found_percent%
  | Blocked (Blacklist) | $activity.decisions.blacklist_hits | $activity.decisions.blacklist_percent%
  | **Total Requests** | **$activity.decisions.total** | **100%**

  === Top Countries (Blacklist) ===

  |= Country |= IP Count |= Trend
  #foreach($country in $activity.top_countries)
  | $country.name | $country.count | #if($country.trend > 0)ğŸ“ˆ +$country.trend%#elseif($country.trend < 0)ğŸ“‰ $country.trend%#elseâ¡ï¸ 0%#end
  #end

#catch
  {{warning}}
  ì‹¤ì‹œê°„ í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  {{/warning}}
#end
{{/velocity}}

----

== Collection Status ==

{{velocity}}
#set($collectionUrl = "${apiBaseUrl}/collection/status")
#try
  #set($collection = $jsontool.parse($request.get($collectionUrl).body))

  |= Service |= Last Run |= Items Collected |= Status |= Duration
  #foreach($service in $collection.services)
  | $service.name | $service.last_run | $service.items_collected | #if($service.success){{success}}âœ“{{/success}}#else{{error}}âœ—{{/error}}#end | $service.duration

  #end

  {{info}}
  **ë‹¤ìŒ ìë™ ìˆ˜ì§‘ ì˜ˆì •**: $collection.next_scheduled (ë§¤ì‹œ ì •ê°)
  {{/info}}

#catch
  {{warning}}
  ìˆ˜ì§‘ ìƒíƒœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  {{/warning}}
#end
{{/velocity}}

----

== Quick Actions ==

{{panel}}
=== ê´€ë¦¬ì ì‘ì—… ===

**ë°ì´í„° ìˆ˜ì§‘**:
* [[ìˆ˜ë™ REGTECH ìˆ˜ì§‘ íŠ¸ë¦¬ê±°>>http://blacklist.jclee.me:2542/api/collection/regtech/trigger]]

**ëª¨ë‹ˆí„°ë§**:
* [[Grafana Dashboard>>https://grafana.jclee.me/d/blacklist-stats]]
* [[Prometheus Metrics>>http://blacklist.jclee.me:2542/metrics]]
* [[Application Health>>http://blacklist.jclee.me:2542/health]]

**API ë¬¸ì„œ**:
* [[Swagger UI>>http://blacklist.jclee.me:2542/api/docs]] (ì¤€ë¹„ ì¤‘)
* [[API Reference>>Main.Blacklist.API]]
{{/panel}}

----

== Performance Metrics ==

{{velocity}}
#set($metricsUrl = "http://blacklist.jclee.me:2542/metrics")
#try
  #set($metricsRaw = $request.get($metricsUrl).body)

  === Key Metrics (Prometheus Format) ===

  {{code language="prometheus"}}
# Total IP check decisions
blacklist_decisions_total{decision="allowed_whitelist"} $metricsRaw.match('blacklist_decisions_total\{decision="allowed_whitelist"\} (\d+)')[0]
blacklist_decisions_total{decision="allowed_not_found"} $metricsRaw.match('blacklist_decisions_total\{decision="allowed_not_found"\} (\d+)')[0]
blacklist_decisions_total{decision="blocked_blacklist"} $metricsRaw.match('blacklist_decisions_total\{decision="blocked_blacklist"\} (\d+)')[0]

# API request count
blacklist_api_requests_total $metricsRaw.match('blacklist_api_requests_total (\d+)')[0]

# Collection duration (seconds)
blacklist_collection_duration_seconds_sum $metricsRaw.match('blacklist_collection_duration_seconds_sum (\d+\.\d+)')[0]
  {{/code}}

  {{info}}
  ì „ì²´ ë©”íŠ¸ë¦­ì€ [[Prometheus>>http://blacklist.jclee.me:2542/metrics]]ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
  {{/info}}

#catch
  {{warning}}
  ë©”íŠ¸ë¦­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  {{/warning}}
#end
{{/velocity}}

----

== Auto-Refresh ==

{{html}}
<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
  <h4 style="margin-top: 0; color: #0066cc;">â±ï¸ ìë™ ìƒˆë¡œê³ ì¹¨</h4>
  <p>ì´ í˜ì´ì§€ëŠ” <strong>30ì´ˆë§ˆë‹¤</strong> ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ë©ë‹ˆë‹¤.</p>
  <div id="refresh-timer" style="font-size: 18px; font-weight: bold; color: #28a745;"></div>
  <button onclick="window.location.reload()" style="background: #0066cc; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-top: 10px;">
    ğŸ”„ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
  </button>
</div>

<script>
(function() {
  const refreshInterval = 30; // seconds
  let countdown = refreshInterval;

  const timerElement = document.getElementById('refresh-timer');

  function updateTimer() {
    timerElement.textContent = `ë‹¤ìŒ ìƒˆë¡œê³ ì¹¨ê¹Œì§€: ${countdown}ì´ˆ`;
    countdown--;

    if (countdown < 0) {
      window.location.reload();
    }
  }

  // Update every second
  setInterval(updateTimer, 1000);
  updateTimer(); // Initial call
})();
</script>

<style>
.xwiki-content table {
  width: 100%;
  margin: 20px 0;
}

.xwiki-content table th {
  background-color: #0066cc;
  color: white;
  padding: 12px;
}

.xwiki-content table td {
  padding: 10px;
  border: 1px solid #ddd;
}

.xwiki-content table tr:nth-child(even) {
  background-color: #f8f9fa;
}
</style>
{{/html}}

----

{{warning}}
**ì£¼ì˜ì‚¬í•­**:
* ì´ í˜ì´ì§€ëŠ” ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ APIì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤
* API ì„œë²„(blacklist.jclee.me:2542)ì— ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì´ í•„ìš”í•©ë‹ˆë‹¤
* ìë™ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì¸í•œ API ë¶€í•˜ë¥¼ ê³ ë ¤í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”
{{/warning}}

{{success}}
**Dashboard v1.0** - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í˜ì´ì§€
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-10-15
{{/success}}

----

== ğŸ’¬ Discussion ==

{{info}}
ì´ ë¬¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì•„ë˜ì— ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.
{{/info}}

{{comment}}
ëŒ“ê¸€ì„ ì¶”ê°€í•˜ì„¸ìš”...
{{/comment}}
