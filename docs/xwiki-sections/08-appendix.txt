= (% id="H8" %)ğŸ“ 8. ë¶€ë¡ =

{{panel title="**âœ¨ ì´ ì„¹ì…˜ì—ì„œ ë°°ìš¸ ë‚´ìš©**"}}
* â˜‘ï¸ í¬íŠ¸ ëª©ë¡ ì „ì²´
* â˜‘ï¸ ì£¼ìš” ëª…ë ¹ì–´ ëª¨ìŒ
* â˜‘ï¸ ë¹ ë¥¸ ì°¸ì¡° ê°€ì´ë“œ
{{/panel}}

---

== ğŸ“‹ í¬íŠ¸ ëª©ë¡ ==

(% class="wikitable" %)
|=(% style="background:#455A64; color:white;" %)ì„œë¹„ìŠ¤|=(% style="background:#455A64; color:white;" %)ì»¨í…Œì´ë„ˆ ë‚´ë¶€|=(% style="background:#455A64; color:white;" %)í˜¸ìŠ¤íŠ¸ ì™¸ë¶€|=(% style="background:#455A64; color:white;" %)ì™¸ë¶€ ë…¸ì¶œ|=(% style="background:#455A64; color:white;" %)ìš©ë„
|âš›ï¸  **blacklist-frontend**|2543|2543|âœ… ì˜ˆ|Next.js ì›¹ UI
|ğŸ **blacklist-app**|2542|2542|âœ… ì˜ˆ|Flask API
|ğŸ“Š **blacklist-collector**|8545|8545|âŒ ì•„ë‹ˆì˜¤|ë°ì´í„° ìˆ˜ì§‘ê¸° (ë‚´ë¶€ ì „ìš©)
|ğŸ˜ **blacklist-postgres**|5432|5432|âŒ ì•„ë‹ˆì˜¤|PostgreSQL DB (ë‚´ë¶€ ì „ìš©)
|ğŸ”´ **blacklist-redis**|6379|6379|âŒ ì•„ë‹ˆì˜¤|Redis ìºì‹œ (ë‚´ë¶€ ì „ìš©)

{{info}}
**ğŸ”’ ë³´ì•ˆ ê¶Œì¥ì‚¬í•­**
* ì™¸ë¶€ ë…¸ì¶œ í¬íŠ¸ (2543, 2542)ë§Œ ë°©í™”ë²½ ì˜¤í”ˆ
* ë‚´ë¶€ í¬íŠ¸ (5432, 6379, 8545)ëŠ” Docker ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
* í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” 2542 í¬íŠ¸ë„ VPN ë˜ëŠ” ë°©í™”ë²½ìœ¼ë¡œ ë³´í˜¸ ê¶Œì¥
{{/info}}

---

== ğŸ› ï¸  ì£¼ìš” ëª…ë ¹ì–´ ëª¨ìŒ ==

=== ğŸ³ Docker ê´€ë¦¬ ===

{{code language="bash"}}
# ğŸ“Š ìƒíƒœ í™•ì¸
docker-compose ps

# ğŸ“‹ ë¡œê·¸ í™•ì¸
docker-compose logs -f blacklist-app
docker-compose logs -f --tail=100 blacklist-app

# ğŸ”„ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart blacklist-app

# ğŸ›‘ ì „ì²´ ì¤‘ì§€
docker-compose down

# ğŸš€ ì „ì²´ ì‹œì‘
docker-compose up -d

# ğŸ”§ íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘
docker-compose restart blacklist-postgres

# ğŸ—‘ï¸  ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker system prune -a --volumes
{{/code}}

=== ğŸ’š í—¬ìŠ¤ì²´í¬ ===

{{code language="bash"}}
# API í—¬ìŠ¤ì²´í¬
curl http://localhost:2542/health | jq

# IP ì²´í¬ í…ŒìŠ¤íŠ¸
curl "http://localhost:2542/api/blacklist/check?ip=1.2.3.4" | jq

# í†µê³„ ì¡°íšŒ
curl http://localhost:2542/api/stats | jq

# Prometheus ë©”íŠ¸ë¦­
curl http://localhost:2542/metrics
{{/code}}

=== ğŸ˜ PostgreSQL ê´€ë¦¬ ===

{{code language="bash"}}
# ğŸ”Œ DB ì—°ê²°
docker exec -it blacklist-postgres psql -U postgres -d blacklist

# ğŸ“Š í…Œì´ë¸” ëª©ë¡
docker exec blacklist-postgres psql -U postgres -d blacklist -c "\dt"

# ğŸ“ˆ ë¸”ë™ë¦¬ìŠ¤íŠ¸ í†µê³„
docker exec blacklist-postgres psql -U postgres -d blacklist << 'SQL'
SELECT
    country,
    COUNT(*) as total,
    COUNT(*) FILTER (WHERE is_active = true) as active
FROM blacklist_ips
GROUP BY country
ORDER BY total DESC
LIMIT 10;
SQL

# ğŸ’¾ ë°±ì—…
docker exec blacklist-postgres pg_dump -U postgres blacklist > \
  /opt/backups/blacklist_$(date +%Y%m%d_%H%M%S).sql

# ğŸ“¥ ë³µì›
docker exec -i blacklist-postgres psql -U postgres -d blacklist < \
  /opt/backups/blacklist_20251014_100000.sql
{{/code}}

=== ğŸ”´ Redis ê´€ë¦¬ ===

{{code language="bash"}}
# ğŸ”Œ Redis ì—°ê²°
docker exec -it blacklist-redis redis-cli

# ğŸ“Š ì •ë³´ í™•ì¸
docker exec blacklist-redis redis-cli INFO stats

# ğŸ” í‚¤ ì¡°íšŒ
docker exec blacklist-redis redis-cli KEYS "ip:*" | head -10

# ğŸ“ˆ ìºì‹œ íˆíŠ¸ìœ¨
docker exec blacklist-redis redis-cli INFO stats | grep -E "keyspace_hits|keyspace_misses"

# ğŸ—‘ï¸  íŠ¹ì • í‚¤ ì‚­ì œ
docker exec blacklist-redis redis-cli DEL "ip:1.2.3.4"

# ğŸ’¥ ì „ì²´ ìºì‹œ ì´ˆê¸°í™” (ì£¼ì˜!)
docker exec blacklist-redis redis-cli FLUSHDB
{{/code}}

---

== ğŸš€ ë¹ ë¥¸ ì°¸ì¡° ==

=== ì¼ì¼ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸ ===

{{panel title="**ğŸ“‹ ì¼ì¼ ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸**"}}
**ë§¤ì¼ ì˜¤ì „ (10ë¶„)**
- [ ] âœ… {{code}}docker-compose ps{{/code}} â†’ 5ê°œ ëª¨ë‘ "healthy"
- [ ] âœ… {{code}}curl http://localhost:2542/health{{/code}} â†’ "status": "healthy"
- [ ] âœ… ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ í™•ì¸: {{code}}df -h{{/code}} â†’ ì—¬ìœ  ê³µê°„ 10GB ì´ìƒ
- [ ] âœ… ë¡œê·¸ ì—ëŸ¬ í™•ì¸: {{code}}docker-compose logs --since 24h \| grep ERROR{{/code}}
- [ ] âœ… í†µê³„ í™•ì¸: {{code}}curl http://localhost:2542/api/stats{{/code}}

**ë§¤ì¼ ë°¤ (ìë™í™” ê¶Œì¥)**
- [ ] âœ… PostgreSQL ë°±ì—…: {{code}}pg_dump{{/code}}
- [ ] âœ… ë°±ì—… íŒŒì¼ ì••ì¶• ë° ì›ê²© ì €ì¥
{{/panel}}

=== ì¥ì•  ëŒ€ì‘ í”Œë¡œìš° ===

{{plantuml}}
@startuml
skinparam backgroundColor white
skinparam activity {
    BackgroundColor<<action>> #E3F2FD
    BackgroundColor<<success>> #C8E6C9
    BackgroundColor<<escalate>> #FFECB3
}

start
:ğŸš¨ ì¥ì•  ê°ì§€;

switch (ì¥ì•  ìœ í˜•?)
case (ì»¨í…Œì´ë„ˆ ë‹¤ìš´)
    :ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ <<action>>\ndocker-compose restart;
case (DB ì—°ê²° ì‹¤íŒ¨)
    :PostgreSQL í™•ì¸ <<action>>\npg_isready;
case (API ì˜¤ë¥˜)
    :ë¡œê·¸ í™•ì¸ <<action>>\ndocker logs;
case (ì„±ëŠ¥ ì €í•˜)
    :ìºì‹œ/DB ìµœì í™” <<action>>\nRedis/PostgreSQL íŠœë‹;
endswitch

:ê²€ì¦ í…ŒìŠ¤íŠ¸;

if (ì •ìƒ ë³µêµ¬?) then (âœ… YES)
    :ë¡œê·¸ ê¸°ë¡ <<success>>\në¬¸ì„œí™”;
    stop
else (âŒ NO)
    :ì „ë¬¸ê°€ ì§€ì› ìš”ì²­ <<escalate>>\nì •ë³´ë³´ì•ˆíŒ€ ì—°ë½;
    stop
endif

@enduml
{{/plantuml}}

---

//ì‘ì„±: ì •ë³´ë³´ì•ˆíŒ€//

----

== ğŸ’¬ Discussion ==

{{info}}
ì´ ë¬¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì•„ë˜ì— ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.
{{/info}}

{{comment}}
ëŒ“ê¸€ì„ ì¶”ê°€í•˜ì„¸ìš”...
{{/comment}}
