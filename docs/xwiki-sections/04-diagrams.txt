= (% id="H4" %)ğŸ“Š 4. ë‹¤ì´ì–´ê·¸ë¨ ëª¨ìŒ =

{{panel title="**âœ¨ ì´ ì„¹ì…˜ì—ì„œ ë°°ìš¸ ë‚´ìš©**"}}
* â˜‘ï¸ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€
* â˜‘ï¸ 3ë‹¨ê³„ ì°¨ë‹¨ ë¡œì§ í”Œë¡œìš°ì°¨íŠ¸
* â˜‘ï¸ ì˜¤í”„ë¼ì¸ íŒ¨í‚¤ì§€ êµ¬ì¡°ë„
* â˜‘ï¸ IP ì²´í¬ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
* â˜‘ï¸ í—¬ìŠ¤ì²´í¬ íë¦„ë„
{{/panel}}

---

== 1ï¸âƒ£ ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í† í´ë¡œì§€ (v3.3.7) ==

{{info}}
**ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±**:
* **blacklist-network**: 172.25.0.0/16 (ë‚´ë¶€ í†µì‹ )
* **traefik-public**: Traefik ê³µìœ  ë„¤íŠ¸ì›Œí¬ (ì™¸ë¶€ ì ‘ê·¼)
{{/info}}

{{plantuml}}
@startuml
skinparam backgroundColor white

cloud "Traefik\n(:443/:80)" as TRAEFIK {
    note right of TRAEFIK
        **ì™¸ë¶€ Reverse Proxy**
        â€¢ SSL ì¢…ë£Œ (443 â†’ 80)
        â€¢ ë„ë©”ì¸ ë¼ìš°íŒ…
        â€¢ blacklist.nxtd.co.kr
    end note
}

package "Docker Host" {
    package "blacklist-network\n172.25.0.0/16" {
        component "blacklist-frontend\n172.25.0.2:2543\nNext.js 14" as FRONTEND #LightBlue
        component "blacklist-app\n172.25.0.3:2542\nFlask 3.0" as APP
        component "blacklist-collector\n172.25.0.4:8545" as COLLECTOR
        database "PostgreSQL\n172.25.0.5:5432" as PG
        database "Redis\n172.25.0.6:6379" as REDIS
    }
}

actor "ì›¹ ë¸Œë¼ìš°ì €" as USER
actor "FortiGate/WAF" as FIREWALL
cloud "REGTECH\nSECUDIUM" as SOURCES

USER --> TRAEFIK : "HTTPS\n:443"
FIREWALL --> TRAEFIK : "HTTPS\n:443"
TRAEFIK --> FRONTEND : "traefik-public\në„¤íŠ¸ì›Œí¬"
FRONTEND --> APP : "ë‚´ë¶€ í†µì‹ \n:2542"
APP --> PG : "ë‚´ë¶€ ì „ìš©\n:5432"
APP --> REDIS : "ë‚´ë¶€ ì „ìš©\n:6379"
COLLECTOR --> SOURCES : "ë°ì´í„° ìˆ˜ì§‘\n(Excel)"
COLLECTOR --> PG : "ë°ì´í„° ì‚½ì…\n:8545"

note right of PG
    **ë‚´ë¶€ ì „ìš© (5ê°œ ì„œë¹„ìŠ¤)**
    â€¢ Frontend: 2543 (Traefik ê²½ìœ )
    â€¢ App: 2542 (ë‚´ë¶€ ì „ìš©)
    â€¢ Collector: 8545
    â€¢ PostgreSQL: 5432
    â€¢ Redis: 6379
end note

note left of FRONTEND
    **traefik-public ì—°ê²°**
    Frontendë§Œ ì™¸ë¶€ ì ‘ê·¼ ê°€ëŠ¥
    ë‚˜ë¨¸ì§€ëŠ” blacklist-networkì— ê²©ë¦¬
end note

@enduml
{{/plantuml}}

---

== 2ï¸âƒ£ ì°¨ë‹¨ ë¡œì§ í”Œë¡œìš°ì°¨íŠ¸ ==

{{panel title="**ğŸ¯ 3ë‹¨ê³„ ì˜ì‚¬ê²°ì • í”„ë¡œì„¸ìŠ¤**"}}
í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ â†’ ë¸”ë™ë¦¬ìŠ¤íŠ¸ â†’ ê¸°ë³¸ í—ˆìš© ìˆœì„œë¡œ ì²´í¬
{{/panel}}

{{plantuml}}
@startuml
skinparam backgroundColor white
skinparam activity {
    BackgroundColor<<allow>> #C8E6C9
    BackgroundColor<<block>> #FFCDD2
}

start
:ì‚¬ìš©ìê°€ IP ì…ë ¥\n(ì˜ˆ: 1.2.3.4);

:ğŸ¥‡ 1ë‹¨ê³„: í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì²´í¬\nSELECT * FROM whitelist_ips\nWHERE ip_address='1.2.3.4';

if (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì—\nì¡´ì¬?) then (âœ… YES)
    :âœ… **í—ˆìš©** <<allow>>\n{\n  "blocked": false,\n  "reason": "whitelist"\n};
    stop
else (âŒ NO)
    :ğŸ¥ˆ 2ë‹¨ê³„: ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì²´í¬\nSELECT * FROM blacklist_ips\nWHERE ip_address='1.2.3.4'\nAND is_active=true;

    if (ë¸”ë™ë¦¬ìŠ¤íŠ¸ì—\nì¡´ì¬?) then (â›” YES)
        :âŒ **ì°¨ë‹¨** <<block>>\n{\n  "blocked": true,\n  "reason": "blacklist"\n};
        stop
    else (âœ… NO)
        :âœ… **í—ˆìš©** <<allow>>\n{\n  "blocked": false,\n  "reason": "not_in_blacklist"\n};
        stop
    endif
endif

@enduml
{{/plantuml}}

**í•µì‹¬ ì›ì¹™:**
* ğŸ¥‡ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ê°€ í•­ìƒ ìš°ì„ 
* ğŸ¥ˆ ë¸”ë™ë¦¬ìŠ¤íŠ¸ëŠ” í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ì—†ì„ ë•Œë§Œ ì²´í¬
* ğŸ¥‰ ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ê¸°ë³¸ í—ˆìš©

---

== 3ï¸âƒ£ ì˜¤í”„ë¼ì¸ íŒ¨í‚¤ì§€ êµ¬ì¡°ë„ (v3.3.7) ==

{{info}}
**ğŸ“¦ 2-íŒŒì¼ ë°°í¬ ë°©ì‹**: blacklist.tar.gz (813MB) + install.sh (20KB)
{{/info}}

{{plantuml}}
@startuml
@startmindmap
skinparam backgroundColor white

* ğŸ“¦ **v3.3.7 íŒ¨í‚¤ì§€**\nblacklist.tar.gz\n(813MB)
** ğŸ³ **Docker ì´ë¯¸ì§€**\n(5ê°œ ì„œë¹„ìŠ¤)
*** blacklist-app(20251029).tar (455MB)
**** + latest ì‹¬ë³¼ë¦­ ë§í¬
*** blacklist-collector(20251029).tar (1.5GB â†’ ì••ì¶•)
**** + latest ì‹¬ë³¼ë¦­ ë§í¬
*** blacklist-postgres(20251029).tar (265MB)
**** + latest ì‹¬ë³¼ë¦­ ë§í¬
*** blacklist-redis(20251029).tar (41MB)
**** + latest ì‹¬ë³¼ë¦­ ë§í¬
*** blacklist-frontend(20251029).tar (206MB)
**** + latest ì‹¬ë³¼ë¦­ ë§í¬
** ğŸ˜ **ë°ì´í„°ë² ì´ìŠ¤**
*** postgres/migrations/
**** 001-017 ë§ˆì´ê·¸ë ˆì´ì…˜ SQL (17ê°œ)
** ğŸ“„ **ì„¤ì • íŒŒì¼**
*** docker-compose.yml
*** .env.example
** ğŸ“š **ë¬¸ì„œ** (XWiki)
*** docs/xwiki-sections/ (14ê°œ íŒŒì¼)
**** 01-deployment.txt
**** 02-architecture.txt
**** 03-api.txt (809ì¤„)
**** 04-diagrams.txt
**** 05-upgrade.txt
**** ê¸°íƒ€ 9ê°œ íŒŒì¼

left side

** ğŸ“œ **install.sh** (ë³„ë„ íŒŒì¼)
*** ì‚¬ì „ ì ê²€ (Docker, ë””ìŠ¤í¬, í¬íŠ¸)
*** ë„¤íŠ¸ì›Œí¬ ê²€ì¦ (REGTECH/SECUDIUM)
*** ì´ë¯¸ì§€ ë¡œë“œ (6ê°œ ì„œë¹„ìŠ¤)
*** ë°ì´í„° ë””ë ‰í„°ë¦¬ ìƒì„±
*** DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©
*** í™˜ê²½ ì„¤ì • (.env)
*** ì„œë¹„ìŠ¤ ë°°í¬ (docker compose)
*** í—¬ìŠ¤ì²´í¬ (6ê°œ í…ŒìŠ¤íŠ¸)
*** API ê²€ì¦ (6ê°œ ì—”ë“œí¬ì¸íŠ¸)

@endmindmap
@enduml
{{/plantuml}}

**ì„¤ì¹˜ ì ˆì°¨ (Air-Gap í™˜ê²½):**
1. {{code}}bash install.sh{{/code}} (í‘œì¤€ ì„¤ì¹˜)
2. {{code}}bash install.sh --skip-network-check{{/code}} (Air-gap ëª¨ë“œ)
3. âœ… 10-15ë¶„ í›„ ì™„ë£Œ

{{warning}}
**âš ï¸ Traefik ë³„ë„ ì„¤ì¹˜ í•„ìš”**
íŒ¨í‚¤ì§€ì— Traefikì´ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. {{code}}docs/TRAEFIK-SETUP.md{{/code}} ì°¸ê³ 
{{/warning}}

---

== 4ï¸âƒ£ IP ì²´í¬ ì „ì²´ ì‹œí€€ìŠ¤ ==

{{panel title="**âš¡ ì„±ëŠ¥ ìµœì í™”**"}}
Redis ìºì‹œ íˆíŠ¸ìœ¨ 85% â†’ í‰ê·  ì‘ë‹µ ì‹œê°„ **0.3ms**
{{/panel}}

{{plantuml}}
@startuml
skinparam backgroundColor white
skinparam sequence {
    ParticipantBackgroundColor LightBlue
    LifeLineBackgroundColor white
}

actor "ğŸ”’ FortiGate" as CLIENT
participant "ğŸ Flask API" as API
database "ğŸ”´ Redis" as REDIS
database "ğŸ˜ PostgreSQL" as DB

== âœ… ìºì‹œ HIT ì‹œë‚˜ë¦¬ì˜¤ (85%) ==

CLIENT -> API: GET /check?ip=1.2.3.4
activate API

API -> REDIS: GET "ip:1.2.3.4"
activate REDIS
REDIS --> API: {"blocked": false, "reason": "whitelist"}
deactivate REDIS

API --> CLIENT: 200 OK (0.3ms)
deactivate API

note right of CLIENT
    **ìºì‹œ HIT**
    â€¢ ì‘ë‹µ ì‹œê°„: 0.3ms
    â€¢ ë°œìƒ í™•ë¥ : 85%
end note

== âŒ ìºì‹œ MISS ì‹œë‚˜ë¦¬ì˜¤ (15%) ==

CLIENT -> API: GET /check?ip=5.6.7.8
activate API

API -> REDIS: GET "ip:5.6.7.8"
activate REDIS
REDIS --> API: (nil)
deactivate REDIS

API -> DB: SELECT * FROM whitelist_ips\nWHERE ip_address='5.6.7.8'
activate DB
DB --> API: ê²°ê³¼ (2ms)
deactivate DB

API -> DB: SELECT * FROM blacklist_ips\nWHERE ip_address='5.6.7.8'\nAND is_active=true
activate DB
DB --> API: ê²°ê³¼ (2ms)
deactivate DB

API -> REDIS: SETEX "ip:5.6.7.8" 3600 "ê²°ê³¼"
activate REDIS
REDIS --> API: OK
deactivate REDIS

API --> CLIENT: 200 OK (5ms)
deactivate API

note right of CLIENT
    **ìºì‹œ MISS**
    â€¢ ì‘ë‹µ ì‹œê°„: 5ms
    â€¢ ë°œìƒ í™•ë¥ : 15%
    â€¢ TTL: 3600ì´ˆ (1ì‹œê°„)
end note

@enduml
{{/plantuml}}

**ì„±ëŠ¥ ë¹„êµ:**
* ìºì‹œ HIT: 0.3ms (85%)
* ìºì‹œ MISS: 5ms (15%)
* í‰ê· : 0.3 Ã— 0.85 + 5 Ã— 0.15 = **1.0ms**

---

== 5ï¸âƒ£ í—¬ìŠ¤ì²´í¬ íë¦„ë„ ==

{{plantuml}}
@startuml
skinparam backgroundColor white
skinparam activity {
    BackgroundColor<<healthy>> #C8E6C9
    BackgroundColor<<degraded>> #FFE082
}

start
:GET /health ìš”ì²­;

:1ï¸âƒ£ PostgreSQL ìƒíƒœ í™•ì¸\npg_isready;

if (PostgreSQL\nì •ìƒ?) then (âœ… YES)
    :postgres: "healthy";
else (âŒ NO)
    :postgres: "unhealthy";
    :HTTP 503\nstatus: "degraded" <<degraded>>;
    stop
endif

:2ï¸âƒ£ Redis ìƒíƒœ í™•ì¸\nPING;

if (Redis\nì •ìƒ?) then (âœ… YES)
    :redis: "healthy";
else (âŒ NO)
    :redis: "unhealthy";
    :HTTP 503\nstatus: "degraded" <<degraded>>;
    stop
endif

:HTTP 200\nstatus: "healthy" <<healthy>>;

note right
    {
      "status": "healthy",
      "timestamp": "2025-10-29T12:00:00Z",
      "version": "3.3.7",
      "dependencies": {
        "postgres": "healthy",
        "redis": "healthy"
      }
    }
end note

stop

@enduml
{{/plantuml}}

---


//ì‘ì„±: ì •ë³´ë³´ì•ˆíŒ€//

----

== ğŸ’¬ Discussion ==

{{info}}
ì´ ë¬¸ì„œì— ëŒ€í•œ ì§ˆë¬¸ì´ë‚˜ í”¼ë“œë°±ì´ ìˆìœ¼ì‹œë©´ ì•„ë˜ì— ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.
{{/info}}

{{comment}}
ëŒ“ê¸€ì„ ì¶”ê°€í•˜ì„¸ìš”...
{{/comment}}
